"use strict";define(["jquery","core/str","core/notification"],function(a,b,c){var d=function(d){this.restUrl=d;var e=function(){return b.get_strings([{key:"ok"},{key:"cancel"},{key:"login"},{key:"error"},{key:"resturlnotset",component:"local_tlcore"},{key:"notloggedinmsg",component:"local_tlcore"},{key:"notloggedin",component:"local_tlcore"}]).then(function(b){var c={};c.ok=b[0],c.cancel=b[1],c.login=b[2],c.error=b[3],c.resturlnotset=b[4],c.notloggedinmsg=b[5],c.notloggedin=b[6];var d=a.Deferred();return d.resolve(c),d})};this.call=function(b,d,f,g,h){var i=this;return e().then(function(e){i.restUrl||c.alert(e.error,e.resturlnotset),d||(d={}),d.action=b;var j=function(){var a=M.cfg.wwwroot+"/login",b="".concat(e.notloggedinmsg,'\n                            <div class="mt-4">\n                                <a target="_blank" href="').concat(a,'">').concat(e.login,"</a>\n                            </div>");c.alert(e.notloggedin,b,e.ok)},k=function(a){h&&h.removeOverlay(),a||(a={status:"jqXHR object invalid",responseText:""}),window.console.error("error - jqXHR",a);var b,d,f;if(a.responseJSON?(b=a.responseJSON.error,d=a.responseJSON.errorcode,f=a.responseJSON.stacktrace):(b="Unknown error",d="unknown",f="unknown - possible bad JSON? "+a.responseText),a.responseJSON&&a.responseJSON.errorcode&&"requireloginerror"===a.responseJSON.errorcode)return j();var g='<div class="ajaxErrors"><div class="ajaxErrorMsg">'+b+'</div><div class="ajaxErrorStatus">Error status code: '+a.status+'</div><div class="ajaxErrorCode">Error code: '+d+'</div><div class="ajaxErrorStackTrace">Stack trace: '+f+"</div></div>";c.alert(e.anerrorhasoccurred,g,e.ok)},l=function(a){if("function"==typeof g){if(g(a))return;k(a)}};return a.ajax({url:i.restUrl,data:d,method:f,error:l}).then(function(a){return h&&h.removeOverlay(),a})})},this.get=function(a,b,c,d){return this.call(a,b,"GET",c,d)},this.post=function(a,b,c,d){return this.call(a,b,"POST",c,d)},this.put=function(a,b,c,d){return this.call(a,b,"PUT",c,d)},this.patch=function(a,b,c,d){return this.call(a,b,"PATCH",c,d)},this["delete"]=function(a,b,c,d){return this.call(a,b,"DELETE",c,d)},this.downloadDirect=function(a,b){var f=this;return e().then(function(e){f.restUrl||c.alert(e.error,e.resturlnotset);var g=document.createElement("a"),h=b?Object.keys(b).map(function(a){return a+"="+encodeURIComponent(b[a])}).join("&"):"";g.setAttribute("href",d+"?action="+a+"&"+h),g.setAttribute("download",b.filename),g.style.visibility="hidden",document.body.appendChild(g),g.click(),document.body.removeChild(g)})}};return{newAPI:function(a){return new d(a)}}});