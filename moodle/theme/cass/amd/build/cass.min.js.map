{"version":3,"sources":["../src/cass.js"],"names":["define","$","ajax","breadcrumb","Templates","Util","require","config","paths","pluginJSURL","path","M","cfg","wwwroot","contextid","shim","exports","self","scrollIn","selector","show","animate","right","opacity","scrollOut","hide","slideNextActivity","popCompletion","TweenMax","fadeTo","whenTrue","length","$aBox","$darkBg","to","display","background","force3D","left","top","delay","scale","backgroundColor","onComplete","addPopCompletion","mod","themeCass","settings","nextactivitymodaldialogdelay","indexOf","modname","setTimeout","init","fixheadertotopofpage","append","bindHsuforumCompletion","submit","loadCompletion","type","async","url","success","data","attr","html","err","window","console","error","setManualCompletion","cmid","call","methodname","args","id","completionstate","fail","response","done","render","then","output","listeners","on","find","toggleClass","e","preventDefault"],"mappings":"AAuBAA,OAAM,mBAAC,CAAC,QAAD,CAAW,WAAX,CAAwB,uBAAxB,CAAiD,gBAAjD,CAAmE,iBAAnE,CAAD,CACF,SAASC,CAAT,CAAYC,CAAZ,CAAkBC,CAAlB,CAA8BC,CAA9B,CAAyCC,CAAzC,CAA+C,CAE/C,MAAO,IAAI,WAAW,CAKlB,CAAC,UAAW,CAKRC,OAAO,CAACC,MAAR,CAAe,CACXC,KAAK,CAAE,CAEH,sBAAuB,CACnB,gEADmB,CAPb,QAAdC,CAAAA,WAAc,CAASC,CAAT,CAAe,CAC7B,MAAOC,CAAAA,CAAC,CAACC,GAAF,CAAMC,OAAN,CAAgB,kBAAhB,CAAqCF,CAAC,CAACC,GAAF,CAAME,SAA3C,CAAuD,cAAvD,CAAwEJ,CAClF,CAQW,CAAY,uBAAZ,CAHmB,CAFpB,CADI,CASXK,IAAI,CAAE,CACF,sBAAuB,CACnBC,OAAO,CAAE,UADU,CADrB,CATK,CAAf,CAeH,CApBD,IALkB,GA2BdC,CAAAA,CAAI,CAAG,IA3BO,CA6BdC,CAAQ,CAAG,SAASC,CAAT,CAAmB,CAC9BlB,CAAC,CAACkB,CAAD,CAAD,CAAYC,IAAZ,GAAmBC,OAAnB,CAA2B,CAACC,KAAK,CAAE,MAAR,CAAgBC,OAAO,CAAE,CAAzB,CAA3B,CAAwD,GAAxD,CACH,CA/BiB,CAiCdC,CAAS,CAAG,SAASL,CAAT,CAAmB,CAC/BlB,CAAC,CAACkB,CAAD,CAAD,CAAYE,OAAZ,CAAoB,CAACC,KAAK,CAAE,QAAR,CAAkBC,OAAO,CAAE,EAA3B,CAApB,CAAqD,GAArD,CAA0D,UAAU,CAAEtB,CAAC,CAACkB,CAAD,CAAD,CAAYM,IAAZ,EAAoB,CAA1F,CACH,CAnCiB,CAqCdC,CAAiB,CAAG,UAAW,CAC/BR,CAAQ,CAAC,wBAAD,CACX,CAvCiB,CAyCdS,CAAa,CAAG,UAAW,CAC3BrB,OAAO,CAAC,CAAC,qBAAD,CAAD,CAA0B,SAASsB,CAAT,CAAmB,CAChD3B,CAAC,CAAC,wBAAD,CAAD,CAA4B4B,MAA5B,CAAmC,MAAnC,CAA2C,CAA3C,CAA8C,UAAW,CACrD5B,CAAC,CAAC,IAAD,CAAD,CAAQwB,IAAR,EACH,CAFD,EAGApB,CAAI,CAACyB,QAAL,CACI,UAAM,CAAC,MAAO7B,CAAAA,CAAC,CAAC,WAAD,CAAD,CAAe8B,MAAf,EAAyB9B,CAAC,CAAC,iBAAD,CAAD,CAAqB8B,MAAQ,CADxE,CAEI,UAAW,IACHC,CAAAA,CAAK,CAAG/B,CAAC,CAAC,WAAD,CADN,CAEHgC,CAAO,CAAGhC,CAAC,CAAC,iBAAD,CAFR,CAGP2B,CAAQ,CAACM,EAAT,CAAYD,CAAZ,CAAsB,CAAtB,CAA2B,CAACE,OAAO,CAAE,OAAV,CAA3B,EACAP,CAAQ,CAACM,EAAT,CAAYD,CAAZ,CAAsB,EAAtB,CAA2B,CAACG,UAAU,CAAE,iBAAb,CAAgCC,OAAO,GAAvC,CAA3B,EACAT,CAAQ,CAACM,EAAT,CAAYF,CAAZ,CAAsB,CAAtB,CAA2B,CAACM,IAAI,CAAE,mBAAP,CAA4BC,GAAG,CAAE,mBAAjC,CAAsDC,KAAK,CAAE,KAA7D,CAA3B,EACAZ,CAAQ,CAACM,EAAT,CAAYF,CAAZ,CAAsB,CAAtB,CAA2B,CAACG,OAAO,CAAE,OAAV,CAAmBZ,OAAO,CAAE,CAA5B,CAA+BiB,KAAK,CAAE,KAAtC,CAA3B,EACAZ,CAAQ,CAACM,EAAT,CAAYF,CAAZ,CAAsB,CAAtB,CAA2B,CAACG,OAAO,CAAE,OAAV,CAAmBM,KAAK,CAAE,EAA1B,CAA+BlB,OAAO,CAAE,CAAxC,CAA2CiB,KAAK,CAAE,KAAlD,CAA3B,EACAZ,CAAQ,CAACM,EAAT,CAAYF,CAAZ,CAAsB,EAAtB,CAA2B,CAACT,OAAO,CAAE,CAAV,CAAac,OAAO,GAApB,CAA4BG,KAAK,CAAE,KAAnC,CAA3B,EACAZ,CAAQ,CAACM,EAAT,CAAYF,CAAZ,CAAsB,EAAtB,CAA2B,CAACS,KAAK,CAAC,CAAP,CAAUJ,OAAO,GAAjB,CAAyBG,KAAK,CAAE,KAAhC,CAA3B,EACAZ,CAAQ,CAACM,EAAT,CAAYD,CAAZ,CAAsB,EAAtB,CAA2B,CAACS,eAAe,CAAE,eAAlB,CAAmCL,OAAO,GAA1C,CAAkDG,KAAK,CAAE,GAAzD,CAA3B,EACAZ,CAAQ,CAACM,EAAT,CAAYD,CAAZ,CAAsB,EAAtB,CAA2B,CAACE,OAAO,CAAE,MAAV,CAAkBE,OAAO,GAAzB,CAAiCG,KAAK,CAAE,GAAxC,CAA3B,EACAZ,CAAQ,CAACM,EAAT,CAAYF,CAAZ,CAAsB,EAAtB,CAA2B,CAACT,OAAO,CAAE,CAAV,CAAaY,OAAO,CAAE,MAAtB,CAA8BE,OAAO,GAArC,CAA6CG,KAAK,CAAE,GAApD,CACvBG,UAAU,CAAEjB,CADW,CAA3B,CAEH,CAhBL,CAkBH,CAtBM,CAuBV,CAjEiB,CAmElB,KAAKkB,gBAAL,CAAwB,SAASC,CAAT,CAAc,CAClC,GAAgE,WAA5D,QAAOlC,CAAAA,CAAC,CAACmC,SAAF,CAAYC,QAAZ,CAAqBC,4BAAhC,CAA6E,CAEzE,GAAiD,CAAC,CAA9C,GADsB,CAAC,MAAD,CAAS,MAAT,CAAiB,MAAjB,CAAyB,UAAzB,CACtB,CAAoBC,OAApB,CAA4BJ,CAAG,CAACK,OAAhC,CAAJ,CAAqD,CAEjDC,UAAU,CACN,UAAW,CACPxB,CAAa,EAChB,CAHK,CAKNhB,CAAC,CAACmC,SAAF,CAAYC,QAAZ,CAAqBC,4BALf,CAOb,CACJ,CACJ,CAdD,CAgBA,KAAKI,IAAL,CAAY,SAASN,CAAT,CAAoBD,CAApB,CAAyB,CACjClC,CAAC,CAACmC,SAAF,CAAcA,CAAd,CACA,GAAInC,CAAC,CAACmC,SAAF,CAAYC,QAAZ,EAAwBpC,CAAC,CAACmC,SAAF,CAAYC,QAAZ,CAAqBM,oBAAjD,CAAuE,CAEnEpD,CAAC,CAAC,MAAD,CAAD,CAAUqD,MAAV,CAAiB,4DAAjB,CACH,CAEDnD,CAAU,CAACiD,IAAX,GAPiC,GAS7BG,CAAAA,CAAsB,CAAG,UAAW,CACpCtD,CAAC,CAAC,uCAAD,CAAD,CAA2CuD,MAA3C,CAAkD,UAAW,CACzDL,UAAU,CACN,UAAW,CACPM,CAAc,EACjB,CAHK,CAGH,GAHG,CAMb,CAPD,CAQH,CAlBgC,CAoB7BA,CAAc,CAAG,UAAW,CAE5B,GAAI,CACAxD,CAAC,CAACC,IAAF,CAAO,CACHwD,IAAI,CAAE,KADH,CAEHC,KAAK,GAFF,CAGHC,GAAG,CAAEjD,CAAC,CAACC,GAAF,CAAMC,OAAN,CAAgB,kCAAhB,cAA4D,aAA5D,CACLgC,CAAG,CAAC/B,SAJD,CAKH+C,OAAO,CAAE,iBAASC,CAAT,CAAe,CACpB7D,CAAC,CAAC,oBAAD,CAAD,CAAwB8D,IAAxB,CAA6B,qBAA7B,CAAoD,GAApD,EACA9D,CAAC,CAAC,oBAAD,CAAD,CAAwB+D,IAAxB,CAA6BF,CAAI,CAACE,IAAlC,EACA/C,CAAI,CAAC2B,gBAAL,CAAsBC,CAAtB,CACH,CATE,CAAP,CAWH,CAAC,MAAMoB,CAAN,CAAW,CACTC,MAAM,CAACC,OAAP,CAAeC,KAAf,CAAqBH,CAArB,CACH,CAGDV,CAAsB,EACzB,CAxCgC,CA0C7Bc,CAAmB,CAAG,SAASC,CAAT,CAAe,CACrCpE,CAAI,CAACqE,IAAL,CAAU,CACN,CACIC,UAAU,CAAE,qCADhB,CAEIC,IAAI,CAAE,CAACC,EAAE,CAAEJ,CAAL,CAAWK,eAAe,CAAE,CAA5B,CAFV,CAGIC,IAAI,CAAE,cAASC,CAAT,CAAmB,CACrBX,MAAM,CAACC,OAAP,CAAeC,KAAf,CAAqBS,CAArB,CACH,CALL,CAMIC,IAAI,CAAE,eAAW,CACb,GAAMhB,CAAAA,CAAI,CAAG7D,CAAC,CAAC,qBAAD,CAAD,CAAyB6D,IAAzB,CAA8B,YAA9B,CAAb,CACA,GAAIA,CAAJ,CAAU,CACN1D,CAAS,CAAC2E,MAAV,CAAiB,4BAAjB,CAA+CjB,CAA/C,EACKkB,IADL,CACU,SAASC,CAAT,CAAiB,CAEnBhF,CAAC,CAAC,oBAAD,CAAD,CAAwBqD,MAAxB,CAA+B2B,CAA/B,CACH,CAJL,CAKH,CACDtD,CAAa,EAChB,CAhBL,CADM,CAAV,OAoBH,CA/DgC,CAyGjC,CAxCgB,QAAZuD,CAAAA,SAAY,EAAW,CAEvBjF,CAAC,CAAC,4BAAD,CAAD,CAA8BkF,EAA9B,CAAiC,OAAjC,CAA0C,UAAY,CAClDlF,CAAC,CAAC,IAAD,CAAD,CAAQmF,IAAR,CAAa,gBAAb,EAA+BC,WAA/B,CAA2C,6CAA3C,CACH,CAFD,EAMApF,CAAC,CAAC,gBAAD,CAAD,CAAoBkF,EAApB,CAAuB,OAAvB,CAAgC,SAAUG,CAAV,CAAa,CACzCA,CAAC,CAACC,cAAF,GACAlB,CAAmB,CAACpE,CAAC,CAAC,IAAD,CAAD,CAAQ6D,IAAR,CAAa,MAAb,CAAD,CACtB,CAHD,EAOA7D,CAAC,CAAC,gBAAD,CAAD,CAAoBkF,EAApB,CAAuB,OAAvB,CAAgC,SAAUG,CAAV,CAAa,CACzC9D,CAAS,CAAC,wBAAD,CAAT,CACA8D,CAAC,CAACC,cAAF,EACH,CAHD,EAMA,GAAY,WAAR,GAAA1C,CAAG,EAA4B,IAAR,GAAAA,CAA3B,CAAyC,CACrC,GAAoB,UAAhB,GAAAA,CAAG,CAACK,OAAR,CAAgC,CAa5BK,CAAsB,EACzB,CACJ,CACJ,CAED,GACH,CACJ,CACJ,CAlMK,CAAN","sourcesContent":["/**\n * This file is part of Moodle - http://moodle.org/\n *\n * Moodle is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Moodle is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n *\n * Theme CASS main JS file.\n *\n * @package   theme_cass\n * @author    Guy Thomas <guy.thomas@tituslearning.com>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'theme_cass/breadcrumb', 'core/templates', 'theme_snap/util'],\n    function($, ajax, breadcrumb, Templates, Util) {\n\n    return new function() {\n\n        // Add some aditional vendor requirejs AMD modules.\n        // For some reason putting this above the define causes a requirejs error when you have mod_bootstrapelements\n        // installed, so it's been moved here.\n        (function() {\n            var pluginJSURL = function(path) {\n                return M.cfg.wwwroot + \"/pluginfile.php/\" + M.cfg.contextid + \"/theme_cass/\" + path;\n            };\n\n            require.config({\n                paths: {\n                    // Vendor code.\n                    \"theme_cass/TweenMax\": [\n                        \"https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.2/TweenMax.min\",\n                        // CDN Fallback - whoop whoop!\n                        pluginJSURL(\"vendorjs/TweenMax.min\")\n                    ]\n                },\n                shim: {\n                    \"theme_cass/TweenMax\": {\n                        exports: \"TweenMax\"\n                    }\n                }\n            });\n        })();\n\n        var self = this;\n\n        var scrollIn = function(selector) {\n            $(selector).show().animate({right: \"20px\", opacity: 1}, 1000);\n        };\n\n        var scrollOut = function(selector) {\n            $(selector).animate({right: \"-600px\", opacity: 0.5}, 200, function(){ $(selector).hide();});\n        };\n\n        var slideNextActivity = function() {\n            scrollIn('#activitycompletemodal');\n        };\n\n        var popCompletion = function() {\n            require(['theme_cass/TweenMax'], function(TweenMax) {\n                $(\".next_activity_overlay\").fadeTo(\"slow\", 0, function() {\n                    $(this).hide();\n                });\n                Util.whenTrue(\n                    () => {return $(\"#alertBox\").length && $(\"#darkBackground\").length;},\n                    function() {\n                        var $aBox = $(\"#alertBox\");\n                        var $darkBg = $(\"#darkBackground\");\n                        TweenMax.to($darkBg,  0,   {display: \"block\"});\n                        TweenMax.to($darkBg,  0.3, {background: \"rgba(0,0,0,0.4)\", force3D: true});\n                        TweenMax.to($aBox,    0,   {left: \"calc(50% - 150px)\", top: \"calc(50% - 150px)\", delay: \"0.2\"});\n                        TweenMax.to($aBox,    0,   {display: \"block\", opacity: 1, delay: \"0.2\"});\n                        TweenMax.to($aBox,    0,   {display: \"block\", scale: 0.2, opacity: 0, delay: \"0.2\"});\n                        TweenMax.to($aBox,    0.3, {opacity: 1, force3D: true, delay: \"0.2\"});\n                        TweenMax.to($aBox,    0.3, {scale:1, force3D: true, delay: \"0.2\"});\n                        TweenMax.to($darkBg,  0.2, {backgroundColor: \"rgba(0,0,0,0)\", force3D: true, delay: \"2\"});\n                        TweenMax.to($darkBg,  0.2, {display: \"none\", force3D: true, delay: \"2\"});\n                        TweenMax.to($aBox,    0.2, {opacity: 0, display: \"none\", force3D: true, delay: \"2\",\n                            onComplete: slideNextActivity});\n                    }\n                );\n            });\n        };\n\n        this.addPopCompletion = function(mod) {\n            if (typeof M.themeCass.settings.nextactivitymodaldialogdelay != 'undefined') {\n                var manualPopActivities = ['page', 'book', 'wiki', 'feedback'];\n                if (manualPopActivities.indexOf(mod.modname) === -1) {\n\n                    setTimeout(\n                        function() {\n                            popCompletion();\n                        },\n\n                        M.themeCass.settings.nextactivitymodaldialogdelay\n                    );\n                }\n            }\n        };\n\n        this.init = function(themeCass, mod) {\n            M.themeCass = themeCass;\n            if (M.themeCass.settings && M.themeCass.settings.fixheadertotopofpage) {\n                // Hack to stop headroom kicking in on nav.\n                $('body').append('<span style=\"display:none\" class=\"notloggedin\"></span>');\n            }\n            // Initialise breadcrumb js\n            breadcrumb.init();\n\n            var bindHsuforumCompletion = function() {\n                $(\".hsuforum-discussion, .hsuforum-reply\").submit(function() {\n                    setTimeout(\n                        function() {\n                            loadCompletion();\n                        }, 3000\n                    );\n\n                });\n            };\n\n            var loadCompletion = function() {\n                var type = 'completion';\n                try {\n                    $.ajax({\n                        type: \"GET\",\n                        async:  true,\n                        url: M.cfg.wwwroot + '/theme/cass/rest.php?action=get_' + type + '&contextid=' +\n                        mod.contextid, // M.cfg.context,\n                        success: function(data) {\n                            $('.completion-region').attr('data-content-loaded', '1');\n                            $('.completion-region').html(data.html);\n                            self.addPopCompletion(mod);\n                        }\n                    });\n                } catch(err) {\n                    window.console.error(err);\n                }\n\n                //bind to the control again\n                bindHsuforumCompletion();\n            };\n\n            var setManualCompletion = function(cmid) {\n                ajax.call([\n                    {\n                        methodname: 'theme_snap_course_module_completion',\n                        args: {id: cmid, completionstate: 1},\n                        fail: function(response) {\n                            window.console.error(response);\n                        },\n                        done: function() {\n                            const data = $('.next_activity_area').data('completion');\n                            if (data) {\n                                Templates.render('theme_cass/completionmodal', data)\n                                    .then(function(output) {\n                                        // Add template output to page.\n                                        $('.completion-region').append(output);\n                                    });\n                            }\n                            popCompletion();\n                        }\n                    }\n                ], true, true);\n            };\n\n            var listeners = function() {\n                // Alternate up/down chevron direction based on collapsable bootstrap elements\n                $('[data-toggle=\"collapse\"]').on('click', function () {\n                    $(this).find(\"span.glyphicon\").toggleClass('glyphicon-chevron-down glyphicon-chevron-up');\n                });\n\n                //listener for completion button click\n                //#completeclick\n                $('.completeclick').on('click', function (e) {\n                    e.preventDefault();\n                    setManualCompletion($(this).data('cmid'));\n                });\n\n                //listener for completion modal close\n                //#completeclick\n                $('.completeclose').on('click', function (e) {\n                    scrollOut('#activitycompletemodal');\n                    e.preventDefault();\n                });\n\n                //Attach specific events for specific mod pages\n                if (mod !== 'undefined' && mod !== null) {\n                    if (mod.modname === 'hsuforum') {\n\n                        //posting a reply inline via hsuforum:\n                        // - Uses a YUI ajax call\n                        // - replaces the article node tagged with the hsuforum-post-target class\n                        // - this node is a child of the mod-hsuforum-posts-container div\n                        // - this node can not be easily targetted by an event listener for a change event\n                        // - can be targeted\n\n                        // Unforunately can not easily attach an event to the hsuform-post-target div\n                        // bind this function to the reply form submit that adds a timer\n                        // to lazy check completion via ajax\n\n                        bindHsuforumCompletion();\n                    }\n                }\n            };\n\n            listeners();\n        };\n    };\n});"],"file":"cass.min.js"}